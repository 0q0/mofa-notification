(function(b){function g(a,d){this.el=b(a);this.options=d;this.autoHide=this.options.autoHide;this.padding=this.options.padding;this.inner=this.el.find(".mofabar-inner");this.inner.css({width:"+="+f(),height:"+="+f()});this.refresh()}function c(a){this.pane=a;this.pane.el.append(this.el);this.innerEl=this.pane.inner.get(0);this.shown=this.enter=this.dragging=!1;this.pane.el.mouseenter(b.proxy(this,"mouseenter"));this.pane.el.mouseleave(b.proxy(this,"mouseleave"));this.el.mousedown(b.proxy(this,"mousedown"));
this.innerPaneScrollListener=b.proxy(this,"scroll");this.pane.inner.scroll(this.innerPaneScrollListener);this.pane.options.initialDisplay&&(this.show(),this.pane.autoHide&&(this.hiding=setTimeout(b.proxy(this,"hide"),1500)))}function l(a,d){function e(){}e.prototype=d.prototype;a.prototype=new e}function f(){if(void 0===h){var a=b('<div class="mofabar-inner" style="width:50px;height:50px;overflow-y:scroll;position:absolute;top:-200px;left:-200px;"><div style="height:100px;width:100%"/></div>');b("body").append(a);
var d=b(a).innerWidth(),e=b("div",a).innerWidth();b(a).remove();h=d-e}return h}b.fn.mofabar=function(a){var d=b.extend({autoHide:!0,padding:2,initialDisplay:!1},a);return this.each(function(){b(this).data("mofabar")&&b(this).data("mofabar").destroy();b(this).data("mofabar",new b.Mofabar(this,d))})};b.Mofabar=g;g.prototype.refresh=function(){var a=this.inner.get(0).scrollWidth>this.el.width()+f(),d=this.inner.get(0).scrollHeight>this.el.height()+f();!this.horizontal&&a?this.horizontal=new c.Horizontal(this):
this.horizontal&&!a?(this.horizontal.destroy(),this.horizontal=null):this.horizontal&&this.horizontal.update();!this.vertical&&d?this.vertical=new c.Vertical(this):this.vertical&&!d?(this.vertical.destroy(),this.vertical=null):this.vertical&&this.vertical.update()};g.prototype.destroy=function(){this.horizontal&&(this.horizontal.destroy(),this.horizontal=null);this.vertical&&(this.vertical.destroy(),this.vertical=null);return this};c.prototype.destroy=function(){this.el.remove();this.pane.inner.unbind("scroll",
this.innerPaneScrollListener);return this};c.prototype.mouseenter=function(){this.enter=!0;this.show()};c.prototype.mouseleave=function(){this.enter=!1;this.dragging||this.pane.autoHide&&this.hide()};c.prototype.scroll=function(){this.shown||(this.show(),this.enter||this.dragging||!this.pane.autoHide||(this.hiding=setTimeout(b.proxy(this,"hide"),1500)));this.update()};c.prototype.mousedown=function(a){a.preventDefault();this.dragging=!0;this.startPageY=a.pageY-parseInt(this.el.css("top"),10);this.startPageX=
a.pageX-parseInt(this.el.css("left"),10);this.el[0].ownerDocument.onselectstart=function(){return!1};var d=b.proxy(this,"mousemove"),e=this;b("html").mousemove(d).mouseup(function(){e.dragging=!1;this.onselectstart=null;b(this).unbind("mousemove",d);e.enter||e.hide()})};c.prototype.show=function(){!this.shown&&this.update()&&(this.el.addClass("mofabar-scrollbar-shown"),this.hiding&&(clearTimeout(this.hiding),this.hiding=null),this.shown=!0)};c.prototype.hide=function(){this.pane.autoHide&&this.shown&&
(this.el.removeClass("mofabar-scrollbar-shown"),this.shown=!1)};c.Vertical=function(a){this.el=b('<div class="mofabar-scrollbar mofabar-scrollbar-y"/>',a.el);c.call(this,a)};l(c.Vertical,c);c.Vertical.prototype.update=function(){var a=this.pane.el.height(),d=a-2*this.pane.padding,e=this.innerEl,b=d*a/e.scrollHeight,b=20>b?20:b,c=d*e.scrollTop/e.scrollHeight;c+b>d&&(c=c-(c+b-d)-3);this.el.css("height",b).css("top",c);return a<e.scrollHeight};c.Vertical.prototype.mousemove=function(a){var b=this.pane.el.height(),
c=b-2*this.pane.padding,k=a.pageY-this.startPageY,f=this.el.height();a=this.innerEl;c-=f;k=Math.min(Math.max(k,0),c);a.scrollTop=(a.scrollHeight-b)*k/c};c.Horizontal=function(a){this.el=b('<div class="mofabar-scrollbar mofabar-scrollbar-x"/>',a.el);c.call(this,a)};l(c.Horizontal,c);c.Horizontal.prototype.update=function(){var a=this.pane.el.width(),b=a-2*this.pane.padding,c=this.pane.inner.get(0);this.el.css("width",b*a/c.scrollWidth).css("left",b*c.scrollLeft/c.scrollWidth);return a<c.scrollWidth};
c.Horizontal.prototype.mousemove=function(a){var b=this.pane.el.width()-2*this.pane.padding,c=a.pageX-this.startPageX,f=this.el.width();a=this.pane.inner.get(0);b-=f;c=Math.min(Math.max(c,0),b);a.scrollLeft=(a.scrollWidth-this.pane.el.width())*c/b};var h})(jQuery);